setwd('C:/2019.01.21.full.BU/64 Schroeder FD CWM')

trait.1 <- read.table('R2.model.random.test1.txt', header=T)
mean.1 <- quantile(trait.1$x, 0.5)
lower.1 <- quantile(trait.1$x, 0.025)
upper.1 <- quantile(trait.1$x, 0.975)

trait.2 <- read.table('R2.model.random.test2.txt', header=T)
mean.2 <- quantile(trait.2$x, 0.5)
lower.2 <- quantile(trait.2$x, 0.025)
upper.2 <- quantile(trait.2$x, 0.975)

trait.3 <- read.table('R2.model.random.test3.txt', header=T)
mean.3 <- quantile(trait.3$x, 0.5)
lower.3 <- quantile(trait.3$x, 0.025)
upper.3 <- quantile(trait.3$x, 0.975)

trait.4 <- read.table('R2.model.random.test4.txt', header=T)
mean.4 <- quantile(trait.4$x, 0.5)
lower.4 <- quantile(trait.4$x, 0.025)
upper.4 <- quantile(trait.4$x, 0.975)

trait.5 <- read.table('R2.model.random.test5.txt', header=T)
mean.5 <- quantile(trait.5$x, 0.5)
lower.5 <- quantile(trait.5$x, 0.025)
upper.5 <- quantile(trait.5$x, 0.975)

trait.6 <- read.table('R2.model.random.test6.txt', header=T)
mean.6 <- quantile(trait.6$x, 0.5)
lower.6 <- quantile(trait.6$x, 0.025)
upper.6 <- quantile(trait.6$x, 0.975)

trait.7 <- read.table('R2.model.random.test7.txt', header=T)
mean.7 <- quantile(trait.7$x, 0.5)
lower.7 <- quantile(trait.7$x, 0.025)
upper.7 <- quantile(trait.7$x, 0.975)

trait.8 <- read.table('R2.model.random.test8.txt', header=T)
mean.8 <- quantile(trait.8$x, 0.5)
lower.8 <- quantile(trait.8$x, 0.025)
upper.8 <- quantile(trait.8$x, 0.975)

trait.9 <- read.table('R2.model.random.test9.txt', header=T)
mean.9 <- quantile(trait.9$x, 0.5)
lower.9 <- quantile(trait.9$x, 0.025)
upper.9 <- quantile(trait.9$x, 0.975)

trait.10 <- read.table('R2.model.random.test10.txt', header=T)
mean.10 <- quantile(trait.10$x, 0.5)
lower.10 <- quantile(trait.10$x, 0.025)
upper.10 <- quantile(trait.10$x, 0.975)

trait.11 <- read.table('R2.model.random.test11.txt', header=T)
mean.11 <- quantile(trait.11$x, 0.5)
lower.11 <- quantile(trait.11$x, 0.025)
upper.11 <- quantile(trait.11$x, 0.975)

trait.12 <- read.table('R2.model.random.test12.txt', header=T)
mean.12 <- quantile(trait.12$x, 0.5)
lower.12 <- quantile(trait.12$x, 0.025)
upper.12 <- quantile(trait.12$x, 0.975)

trait.13 <- read.table('R2.model.random.test13.txt', header=T)
mean.13 <- quantile(trait.13$x, 0.5)
lower.13 <- quantile(trait.13$x, 0.025)
upper.13 <- quantile(trait.13$x, 0.975)

trait.14 <- read.table('R2.model.random.test14.txt', header=T)
mean.14 <- quantile(trait.14$x, 0.5)
lower.14 <- quantile(trait.14$x, 0.025)
upper.14 <- quantile(trait.14$x, 0.975)

trait.15 <- read.table('R2.model.random.test15.txt', header=T)
mean.15 <- quantile(trait.15$x, 0.5)
lower.15 <- quantile(trait.15$x, 0.025)
upper.15 <- quantile(trait.15$x, 0.975)

trait.16 <- read.table('R2.model.random.test16.txt', header=T)
mean.16 <- quantile(trait.16$x, 0.5)
lower.16 <- quantile(trait.16$x, 0.025)
upper.16 <- quantile(trait.16$x, 0.975)

trait.17 <- read.table('R2.model.random.test17.txt', header=T)
mean.17 <- quantile(trait.17$x, 0.5)
lower.17 <- quantile(trait.17$x, 0.025)
upper.17 <- quantile(trait.17$x, 0.975)

trait.18 <- read.table('R2.model.random.test18.txt', header=T)
mean.18 <- quantile(trait.18$x, 0.5)
lower.18 <- quantile(trait.18$x, 0.025)
upper.18 <- quantile(trait.18$x, 0.975)

trait.19 <- read.table('R2.model.random.test19.txt', header=T)
mean.19 <- quantile(trait.19$x, 0.5)
lower.19 <- quantile(trait.19$x, 0.025)
upper.19 <- quantile(trait.19$x, 0.975)

trait.20 <- read.table('R2.model.random.test20.txt', header=T)
mean.20 <- quantile(trait.20$x, 0.5)
lower.20 <- quantile(trait.20$x, 0.025)
upper.20 <- quantile(trait.20$x, 0.975)

trait.21 <- read.table('R2.model.random.test21.txt', header=T)
mean.21 <- quantile(trait.21$x, 0.5)
lower.21 <- quantile(trait.21$x, 0.025)
upper.21 <- quantile(trait.21$x, 0.975)

trait.22 <- read.table('R2.model.random.test22.txt', header=T)
mean.22 <- quantile(trait.22$x, 0.5)
lower.22 <- quantile(trait.22$x, 0.025)
upper.22 <- quantile(trait.22$x, 0.975)

trait.23 <- read.table('R2.model.random.test23.txt', header=T)
mean.23 <- quantile(trait.23$x, 0.5)
lower.23 <- quantile(trait.23$x, 0.025)
upper.23 <- quantile(trait.23$x, 0.975)

trait.24 <- read.table('R2.model.random.test24.txt', header=T)
mean.24 <- quantile(trait.24$x, 0.5)
lower.24 <- quantile(trait.24$x, 0.025)
upper.24 <- quantile(trait.24$x, 0.975)

trait.25 <- read.table('R2.model.random.test25.txt', header=T)
mean.25 <- quantile(trait.25$x, 0.5)
lower.25 <- quantile(trait.25$x, 0.025)
upper.25 <- quantile(trait.25$x, 0.975)

trait.26 <- read.table('R2.model.random.test26.txt', header=T)
mean.26 <- quantile(trait.26$x, 0.5)
lower.26 <- quantile(trait.26$x, 0.025)
upper.26 <- quantile(trait.26$x, 0.975)

trait.27 <- read.table('R2.model.random.test27.txt', header=T)
mean.27 <- quantile(trait.27$x, 0.5)
lower.27 <- quantile(trait.27$x, 0.025)
upper.27 <- quantile(trait.27$x, 0.975)

trait.28 <- read.table('R2.model.random.test28.txt', header=T)
mean.28 <- quantile(trait.28$x, 0.5)
lower.28 <- quantile(trait.28$x, 0.025)
upper.28 <- quantile(trait.28$x, 0.975)

trait.29 <- read.table('R2.model.random.test29.txt', header=T)
mean.29 <- quantile(trait.29$x, 0.5)
lower.29 <- quantile(trait.29$x, 0.025)
upper.29 <- quantile(trait.29$x, 0.975)

trait.30 <- read.table('R2.model.random.test30.txt', header=T)
mean.30 <- quantile(trait.30$x, 0.5)
lower.30 <- quantile(trait.30$x, 0.025)
upper.30 <- quantile(trait.30$x, 0.975)

trait.31 <- read.table('R2.model.random.test31.txt', header=T)
mean.31 <- quantile(trait.31$x, 0.5)
lower.31 <- quantile(trait.31$x, 0.025)
upper.31 <- quantile(trait.31$x, 0.975)

trait.32 <- read.table('R2.model.random.test32.txt', header=T)
mean.32 <- quantile(trait.32$x, 0.5)
lower.32 <- quantile(trait.32$x, 0.025)
upper.32 <- quantile(trait.32$x, 0.975)

trait.33 <- read.table('R2.model.random.test33.txt', header=T)
mean.33 <- quantile(trait.33$x, 0.5)
lower.33 <- quantile(trait.33$x, 0.025)
upper.33 <- quantile(trait.33$x, 0.975)

trait.34 <- read.table('R2.model.random.test34.txt', header=T)
mean.34 <- quantile(trait.34$x, 0.5)
lower.34 <- quantile(trait.34$x, 0.025)
upper.34 <- quantile(trait.34$x, 0.975)

trait.35 <- read.table('R2.model.random.test35.txt', header=T)
mean.35 <- quantile(trait.35$x, 0.5)
lower.35 <- quantile(trait.35$x, 0.025)
upper.35 <- quantile(trait.35$x, 0.975)

trait.36 <- read.table('R2.model.random.test36.txt', header=T)
mean.36 <- quantile(trait.36$x, 0.5)
lower.36 <- quantile(trait.36$x, 0.025)
upper.36 <- quantile(trait.36$x, 0.975)

trait.37 <- read.table('R2.model.random.test37.txt', header=T)
mean.37 <- quantile(trait.37$x, 0.5)
lower.37 <- quantile(trait.37$x, 0.025)
upper.37 <- quantile(trait.37$x, 0.975)

trait.38 <- read.table('R2.model.random.test38.txt', header=T)
mean.38 <- quantile(trait.38$x, 0.5)
lower.38 <- quantile(trait.38$x, 0.025)
upper.38 <- quantile(trait.38$x, 0.975)

trait.39 <- read.table('R2.model.random.test39.txt', header=T)
mean.39 <- quantile(trait.39$x, 0.5)
lower.39 <- quantile(trait.39$x, 0.025)
upper.39 <- quantile(trait.39$x, 0.975)

trait.40 <- read.table('R2.model.random.test40.txt', header=T)
mean.40 <- quantile(trait.40$x, 0.5)
lower.40 <- quantile(trait.40$x, 0.025)
upper.40 <- quantile(trait.40$x, 0.975)

mean.all <- c(0,mean.1,mean.2,mean.3,mean.4,mean.5,mean.6,mean.7,mean.8,mean.9,
              mean.10,mean.11,mean.12,mean.13,mean.14,mean.15,mean.16,
              mean.17,mean.18,mean.19,mean.20,mean.21,mean.22,mean.23,
              mean.24,mean.25,mean.26,mean.27,mean.28,mean.29,mean.30,
              mean.31,mean.32,mean.33,mean.34,mean.35,mean.36,mean.37,
              mean.38,mean.39,mean.40,.127)
lower.all <- c(0,lower.1,lower.2,lower.3,lower.4,lower.5,lower.6,lower.7,lower.8,lower.9,
               lower.10,lower.11,lower.12,lower.13,lower.14,lower.15,lower.16,
               lower.17,lower.18,lower.19,lower.20,lower.21,lower.22,lower.23,
               lower.24,lower.25,lower.26,lower.27,lower.28,lower.29,lower.30,
               lower.31,lower.32,lower.33,lower.34,lower.35,lower.36,lower.37,
               lower.38,lower.39,lower.40)
upper.all <- c(0,upper.1,upper.2,upper.3,upper.4,upper.5,upper.6,upper.7,upper.8,upper.9,
               upper.10,upper.11,upper.12,upper.13,upper.14,upper.15,upper.16,
               upper.17,upper.18,upper.19,upper.20,upper.21,upper.22,upper.23,
               upper.24,upper.25,upper.26,upper.27,upper.28,upper.29,upper.30,
               upper.31,upper.32,upper.33,upper.34,upper.35,upper.36,upper.37,
               upper.38,upper.39,upper.40)


par(mfrow=c(1,1),mar=c(5,4,1,1))
plot(c(0:41), 100*mean.all,
     xlim=c(1,41), ylim=c(0,15), xlab="Number of traits analysed",
     ylab="Variance explained (%)", pch=21, bg="cornflowerblue")
polygon(c(rev(c(0:40)), c(0:40)), 
        c(rev(100*lower.all), 100*upper.all),
        col = 'grey80', border = NA)
lines(c(0:41), c(100*mean.all))
points(c(0:41), c(100*mean.all),
       pch=21, bg="cornflowerblue")
points(6, 4.8, pch=21, bg="coral3", cex=1.4)

x <- c(0:41)
model1 <- nls(mean.all ~ y.max * x/(K + x), start=list(y.max=0.18, K=20))
summary(model1)
summary(model1)$coefficients[1,1]*0.8
summary(model1)$coefficients[1,1]

start=list(y.max=0.1835681, K=19.211451)
par(mfrow=c(1,1),mar=c(5,4,1,1))
plot(c(0:41), 100*mean.all,
     xlim=c(1,100), ylim=c(0,15), xlab="Number of traits analysed",
     ylab="Variance explained (%)", pch=21, bg="cornflowerblue")
polygon(c(rev(c(0:40)), c(0:40)), 
        c(rev(100*lower.all), 100*upper.all),
        col = 'grey80', border = NA)
lines(c(0:41), c(100*mean.all))
points(c(0:41), c(100*mean.all),
       pch=21, bg="cornflowerblue")
points(6, 4.8, pch=21, bg="coral3", cex=1.2)

x <- c(0:1000)
predict.y <- summary(model1)$coefficients[1,1] * x / (summary(model1)$coefficients[2,1] + x)
lines(c(0:1000), 100*predict.y, lty=2, col="red")
which(predict.y > summary(model1)$coefficients[1,1]*0.8)
min(which(predict.y > 0.05))
